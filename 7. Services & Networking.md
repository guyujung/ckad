# Service

service란 application 안밖의 다양한 구성요소 간의 통신을 가능하도록 해줍니다.

ssh로 쿠버네티스 host pc가 pod에 접근할 수 있습니다.

그러나 ssh없이 접근하려면 중간에 뭔가 있어야 접근 할 수 있습니다. 
이 작업을 service가 대신할 수 있습니다.

서비스는 노드 안의 가상 서버와 같습니다. 클러스터 내부에 고유한 ip 주소(서비스의 클러스터 ip)가 있습니다.

## node port

nodePort-> port -> targetPort

nodePort는 외부와 통신

```
apiVersion: v1
kind: Service
metadata:
    name: myapp-service
spec:
    type: NodePort
    ports:
        - targetPort: 80    
          port: 80
          nodePort: 30008
    selector:
        app: myapp
        type: front-end
```

pod가 여러 개라면 selector를 통해 같은 label의 pod를 찾아 연결 시켜줍니다.
multi node에 pod가 각각 따로 있다면 service는 가로질러서 pod와 연결 시켜줍니다.

# cluster ip

pod는 ip로 구성되어 있습니다. 이 pod들은 언제 죽을지 모릅니다. 그렇기 때문에 앱 갑 내부 통신에 이 ip로만 의존할 수 없습니다.

쿠버네티스 서비스를 통해 pod를 하나로 묶고 하나의 인터페이스를 통해 단체로 접속 가능합니다.

```
apiVersion: v1
kind: Service
metadata:
    name: back-end
spec:
    type: ClusterIP
    ports:
      - targetPort: 80  #pod의 port. back-end pod가 노출된 port
        port: 80        #service의 port. service가 노출된 port
    selector:
      app: myapp
      type: back-end
```


